<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>SRMS Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        :root {
            --primary: #1b2a41;
            --primary-dark: #111827;
            --accent: #2563eb;
            --accent-soft: #dbeafe;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --danger: #ef4444;
            --success: #16a34a;
            --warn: #f59e0b;
            --muted: #6b7280;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: #111827;
        }

        /* ========== LOGIN OVERLAY ========== */
        #loginOverlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, #1f2937, #020617);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .login-card {
            background: rgba(17, 24, 39, 0.96);
            padding: 28px 26px;
            border-radius: 18px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 18px 40px rgba(0,0,0,0.5);
            color: #f9fafb;
        }

        .login-card h1 {
            margin: 0 0 8px 0;
            font-size: 24px;
        }

        .login-sub {
            font-size: 13px;
            color: #9ca3af;
            margin-bottom: 18px;
        }

        .login-field {
            margin-bottom: 12px;
        }

        .login-field label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
        }

        .login-field input {
            width: 100%;
            padding: 9px 10px;
            border-radius: 10px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
            font-size: 14px;
        }

        .login-field input:focus {
            outline: 1px solid var(--accent);
            border-color: var(--accent);
        }

        .login-btn {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #3b82f6, #22c55e);
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        .login-error {
            margin-top: 8px;
            color: #fca5a5;
            font-size: 13px;
            min-height: 18px;
        }

        .login-hint {
            margin-top: 10px;
            font-size: 11px;
            color: #9ca3af;
        }

        /* ========== LAYOUT ========== */

        .app-shell {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, var(--primary), #020617);
            color: #e5e7eb;
            display: flex;
            flex-direction: column;
            padding: 18px 14px;
        }

        .sidebar-logo {
            font-size: 20px;
            font-weight: 700;
            padding: 6px 10px 14px 10px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.35);
            margin-bottom: 10px;
        }

        .sidebar-logo span {
            color: #facc15;
        }

        .sidebar-section-title {
            font-size: 11px;
            text-transform: uppercase;
            color: #9ca3af;
            margin: 10px 10px 6px 10px;
            letter-spacing: 0.08em;
        }

        .nav-item {
            border: none;
            width: 100%;
            text-align: left;
            padding: 8px 10px;
            margin: 3px 0;
            border-radius: 10px;
            background: transparent;
            color: #e5e7eb;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item span.icon {
            font-size: 16px;
        }

        .nav-item.active {
            background: #facc15;
            color: #111827;
            font-weight: 600;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 8px 10px;
            font-size: 12px;
            color: #9ca3af;
            border-top: 1px solid rgba(148, 163, 184, 0.35);
        }

        .sidebar-footer small {
            display: block;
            margin-top: 4px;
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 4px;
        }

        .status-online {
            background: #22c55e;
        }

        .status-offline {
            background: #ef4444;
        }

        /* MAIN AREA */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .topbar {
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            padding: 10px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .topbar-title {
            font-weight: 600;
            font-size: 18px;
        }

        .topbar-sub {
            font-size: 12px;
            color: var(--muted);
        }

        .topbar-right {
            font-size: 13px;
            color: var(--muted);
        }

        .topbar-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 999px;
            background: #eff6ff;
            color: #1d4ed8;
            font-size: 11px;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 18px 20px 24px 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* DASHBOARD CARDS */
        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
            gap: 14px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            box-shadow: 0 1px 4px rgba(15, 23, 42, 0.08);
        }

        .card-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
            margin-bottom: 6px;
        }

        .card-main {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
        }

        .card-main span.value {
            font-size: 22px;
            font-weight: 700;
        }

        .card-main span.trend {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 999px;
        }

        .trend-up {
            background: #dcfce7;
            color: #15803d;
        }

        .trend-flat {
            background: #e5e7eb;
            color: #374151;
        }

        .trend-down {
            background: #fee2e2;
            color: #b91c1c;
        }

        .section-title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0 8px 0;
        }

        .section-title-row h2 {
            margin: 0;
            font-size: 18px;
        }

        .section-title-row small {
            color: var(--muted);
        }

        /* TABLES */
        .table-scroll {
            overflow-x: auto;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 13px;
        }

        th, td {
            padding: 8px 10px;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
        }

        th {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--muted);
            background: #f9fafb;
        }

        tr:hover td {
            background: #f9fafb;
        }

        .status-pill {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 11px;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-ready {
            background: #dcfce7;
            color: #166534;
        }

        .status-other {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-link {
            border: none;
            background: none;
            padding: 0;
            margin: 0;
            color: var(--accent);
            font-size: 12px;
            cursor: pointer;
        }

        .btn-small {
            padding: 4px 8px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-small.danger {
            background: #fee2e2;
            color: #b91c1c;
        }

        .btn-small.primary {
            background: #dbeafe;
            color: #1d4ed8;
        }

        /* ORDER DETAIL ROW */
        .order-detail-row td {
            background: #f9fafb;
        }

        .order-items-list {
            margin: 4px 0 0 0;
            padding-left: 18px;
            font-size: 12px;
        }

        .order-items-list li {
            margin-bottom: 2px;
        }

        /* RESERVATIONS PAGE */
        .res-grid {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
            gap: 16px;
        }

        @media (max-width: 900px) {
            .app-shell {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                height: auto;
            }
            .sidebar-logo {
                border-bottom: none;
                margin-bottom: 0;
            }
            .sidebar-section-title,
            .sidebar-footer {
                display: none;
            }
        }

        @media (max-width: 800px) {
            .res-grid {
                grid-template-columns: 1fr;
            }
        }

        .res-list-item {
            padding: 8px 10px;
            border-radius: 10px;
            background: #f9fafb;
            margin-bottom: 6px;
            border-left: 4px solid var(--accent);
            font-size: 13px;
        }

        /* MENU PAGE */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
        }

        .menu-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 4px rgba(15,23,42,0.09);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .menu-card img {
            width: 100%;
            height: 130px;
            object-fit: cover;
        }

        .menu-card-body {
            padding: 10px 12px;
        }

        .menu-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 6px;
            font-size: 12px;
            color: var(--muted);
        }

        /* ANALYTICS PAGE */
        .analytics-list li {
            margin-bottom: 4px;
        }

        /* TOAST */
        .toast {
            position: fixed;
            bottom: 18px;
            right: 18px;
            background: #111827;
            color: white;
            padding: 9px 14px;
            border-radius: 999px;
            font-size: 13px;
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
            z-index: 50;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
    </style>
</head>
<body>

<!-- ========== LOGIN OVERLAY ========== -->
<div id="loginOverlay">
    <div class="login-card">
        <h1>SRMS Admin</h1>
        <div class="login-sub">
            Sign in to manage orders, reservations, menu, and analytics.
        </div>
        <div class="login-field">
            <label for="loginUser">Username</label>
            <input id="loginUser" type="text" placeholder="admin" />
        </div>
        <div class="login-field">
            <label for="loginPass">Password</label>
            <input id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
        <button class="login-btn" onclick="handleLogin()">Sign In</button>
        <div class="login-error" id="loginError"></div>
        <div class="login-hint">
            Demo credentials: <b>admin / admin123</b><br>
            Backend must be running at <code>http://127.0.0.1:5000</code>.
        </div>
    </div>
</div>

<!-- ========== APP SHELL ========== -->
<div class="app-shell" id="appShell" style="display:none;">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            SRMS <span>Admin</span>
        </div>

        <div class="sidebar-section-title">Main</div>
        <button class="nav-item active" onclick="showPage('dashboardPage', this)">
            <span class="icon">üìä</span> Dashboard
        </button>
        <button class="nav-item" onclick="showPage('ordersPage', this)">
            <span class="icon">üßæ</span> Orders
        </button>
        <button class="nav-item" onclick="showPage('reservationsPage', this)">
            <span class="icon">üìÖ</span> Reservations
        </button>
        <button class="nav-item" onclick="showPage('menuPage', this)">
            <span class="icon">üçΩÔ∏è</span> Menu
        </button>
        <button class="nav-item" onclick="showPage('analyticsPage', this)">
            <span class="icon">üìà</span> Analytics
        </button>

        <div class="sidebar-footer">
            <div id="sidebarBackendStatus">
                <span class="status-dot status-offline"></span> Backend: checking...
            </div>
            <small>Logged in as <b>admin</b></small>
        </div>
    </aside>

    <!-- MAIN AREA -->
    <div class="main-area">
        <header class="topbar">
            <div>
                <div class="topbar-title" id="topbarTitle">Dashboard</div>
                <div class="topbar-sub">
                    Smart Restaurant Management System ‚Äì admin console
                </div>
            </div>
            <div class="topbar-right">
                <span class="topbar-tag">
                    <span>‚öôÔ∏è</span> In-memory demo (no real DB)
                </span>
            </div>
        </header>

        <main class="main-content">
            <!-- DASHBOARD PAGE -->
            <section id="dashboardPage" class="page active">
                <div class="grid-cards">
                    <div class="card">
                        <div class="card-title">Total Orders</div>
                        <div class="card-main">
                            <span class="value" id="dashTotalOrders">0</span>
                            <span class="trend trend-up">Live</span>
                        </div>
                        <small class="muted">Counts all orders from /api/orders</small>
                    </div>
                    <div class="card">
                        <div class="card-title">Total Revenue (AED)</div>
                        <div class="card-main">
                            <span class="value" id="dashTotalRevenue">0</span>
                            <span class="trend trend-flat">Demo</span>
                        </div>
                        <small class="muted">Based on order totals in memory.</small>
                    </div>
                    <div class="card">
                        <div class="card-title">Reservations</div>
                        <div class="card-main">
                            <span class="value" id="dashTotalReservations">0</span>
                            <span class="trend trend-up">Today</span>
                        </div>
                        <small class="muted">Fetched from /api/reservations.</small>
                    </div>
                    <div class="card">
                        <div class="card-title">Top Item</div>
                        <div class="card-main">
                            <span class="value" id="dashTopItem">‚Äì</span>
                            <span class="trend trend-flat">Menu</span>
                        </div>
                        <small class="muted">From /api/analytics top_items.</small>
                    </div>
                </div>

                <div class="section-title-row">
                    <h2>Recent Orders</h2>
                    <small>Last 5 orders from /api/orders</small>
                </div>
                <div class="card table-scroll">
                    <table id="dashboardOrdersTable">
                        <thead>
                            <tr>
                                <th>#ID</th>
                                <th>Customer</th>
                                <th>Total (AED)</th>
                                <th>Status</th>
                                <th>Items</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ORDERS PAGE -->
            <section id="ordersPage" class="page">
                <div class="section-title-row">
                    <h2>Orders</h2>
                    <small>Full list of orders placed from the customer app.</small>
                </div>
                <div class="card table-scroll">
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>#ID</th>
                                <th>Customer</th>
                                <th>Total (AED)</th>
                                <th>Status</th>
                                <th>Item Count</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- RESERVATIONS PAGE -->
            <section id="reservationsPage" class="page">
                <div class="section-title-row">
                    <h2>Reservations</h2>
                    <small>View upcoming reservations saved via frontend.</small>
                </div>
                <div class="res-grid">
                    <div class="card">
                        <h3 style="margin-top:0;">Upcoming Reservations</h3>
                        <div id="resList">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                    <div class="card">
                        <h3 style="margin-top:0;">Quick Snapshot</h3>
                        <p id="resSummaryText" style="font-size: 13px; color: var(--muted);">
                            Loading...
                        </p>
                        <ul id="resSummaryList" style="font-size: 13px; padding-left: 18px;"></ul>
                    </div>
                </div>
            </section>

            <!-- MENU PAGE -->
            <section id="menuPage" class="page">
                <div class="section-title-row">
                    <h2>Menu Items</h2>
                    <small>Loaded from /api/menu (backend in-memory).</small>
                </div>
                <div class="menu-grid" id="menuGridAdmin">
                    <!-- Cards filled by JS -->
                </div>
            </section>

            <!-- ANALYTICS PAGE -->
            <section id="analyticsPage" class="page">
                <div class="section-title-row">
                    <h2>Analytics</h2>
                    <small>Powered by /api/analytics.</small>
                </div>

                <div class="grid-cards">
                    <div class="card">
                        <div class="card-title">Total Orders</div>
                        <div class="card-main">
                            <span class="value" id="anTotalOrders">0</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">Total Revenue (AED)</div>
                        <div class="card-main">
                            <span class="value" id="anTotalRevenue">0</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-top:0;">Top Items</h3>
                    <ul id="analyticsTopItems" class="analytics-list"></ul>
                </div>
            </section>
        </main>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
    const API_BASE = "http://127.0.0.1:5000";

    let ordersCache = [];
    let reservationsCache = [];
    let menuCache = [];

    // -------- LOGIN ----------
    function handleLogin() {
        const user = document.getElementById("loginUser").value.trim();
        const pass = document.getElementById("loginPass").value.trim();
        const err = document.getElementById("loginError");
        err.textContent = "";

        // Demo credentials
        if (user === "admin" && pass === "admin123") {
            document.getElementById("loginOverlay").style.display = "none";
            document.getElementById("appShell").style.display = "flex";
            showToast("Welcome, admin üëã");
            initAdmin();
        } else {
            err.textContent = "Invalid credentials. Use admin / admin123 for demo.";
        }
    }

    // -------- TOAST ----------
    function showToast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 2200);
    }

    // -------- PAGE SWITCH ----------
    function showPage(pageId, btn) {
        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        document.getElementById(pageId).classList.add("active");

        document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));
        if (btn) btn.classList.add("active");

        const titleMap = {
            dashboardPage: "Dashboard",
            ordersPage: "Orders",
            reservationsPage: "Reservations",
            menuPage: "Menu",
            analyticsPage: "Analytics"
        };
        document.getElementById("topbarTitle").textContent = titleMap[pageId] || "Admin";

        if (pageId === "ordersPage") loadOrders();
        if (pageId === "reservationsPage") loadReservations();
        if (pageId === "menuPage") loadMenuAdmin();
        if (pageId === "analyticsPage") loadAnalytics();
        if (pageId === "dashboardPage") refreshDashboard();
    }

    // -------- BACKEND HEALTH ----------
    async function checkBackend() {
        const el = document.getElementById("sidebarBackendStatus");
        el.innerHTML = `<span class="status-dot status-offline"></span> Backend: checking...`;

        try {
            const res = await fetch(`${API_BASE}/api/health`);
            if (!res.ok) throw new Error();
            const data = await res.json();
            el.innerHTML = `<span class="status-dot status-online"></span> Backend: ${data.status}`;
        } catch {
            el.innerHTML = `<span class="status-dot status-offline"></span> Backend: offline`;
        }
    }

    // -------- DATA LOADERS ----------

    async function loadOrders() {
        try {
            const res = await fetch(`${API_BASE}/api/orders`);
            if (!res.ok) throw new Error();
            const data = await res.json();
            ordersCache = data.orders || [];
        } catch {
            ordersCache = [];
        }
        renderOrdersTable();
        refreshDashboard();
    }

    function renderOrdersTable() {
        const body = document.getElementById("ordersTableBody");
        body.innerHTML = "";

        if (ordersCache.length === 0) {
            body.innerHTML = `<tr><td colspan="6">No orders yet.</td></tr>`;
            return;
        }

        ordersCache.forEach(order => {
            const itemCount = (order.items || []).length;
            const statusClass = order.status === "PENDING"
                ? "status-pending" : order.status === "READY"
                ? "status-ready" : "status-other";

            const rowId = `order-detail-${order.id}`;

            body.innerHTML += `
                <tr>
                    <td>${order.id}</td>
                    <td>${order.customer_name || "Guest"}</td>
                    <td>${Number(order.total || 0).toFixed(2)}</td>
                    <td><span class="status-pill ${statusClass}">${order.status}</span></td>
                    <td>${itemCount}</td>
                    <td>
                        <button class="btn-link" onclick="toggleOrderItems('${rowId}')">
                            View Items
                        </button>
                    </td>
                </tr>
                <tr id="${rowId}" class="order-detail-row" style="display:none;">
                    <td colspan="6">
                        <ul class="order-items-list">
                            ${itemCount === 0 ? "<li>No items in this order.</li>" :
            order.items.map(it => `<li>${it.name} ‚Äî AED ${Number(it.price || 0).toFixed(2)}</li>`).join("")}
                        </ul>
                    </td>
                </tr>
            `;
        });

        // Also fill dashboard recent orders table (last 5)
        const dashBody = document.querySelector("#dashboardOrdersTable tbody");
        dashBody.innerHTML = "";
        const lastFive = [...ordersCache].slice(-5).reverse();
        lastFive.forEach(o => {
            const statusClass = o.status === "PENDING"
                ? "status-pending" : o.status === "READY"
                ? "status-ready" : "status-other";

            const names = (o.items || []).map(i => i.name).join(", ") || "‚Äì";

            dashBody.innerHTML += `
                <tr>
                    <td>${o.id}</td>
                    <td>${o.customer_name || "Guest"}</td>
                    <td>${Number(o.total || 0).toFixed(2)}</td>
                    <td><span class="status-pill ${statusClass}">${o.status}</span></td>
                    <td>${names}</td>
                </tr>
            `;
        });
    }

    function toggleOrderItems(rowId) {
        const row = document.getElementById(rowId);
        if (!row) return;
        row.style.display = row.style.display === "none" ? "table-row" : "none";
    }

    async function loadReservations() {
        try {
            const res = await fetch(`${API_BASE}/api/reservations`);
            if (!res.ok) throw new Error();
            const data = await res.json();
            reservationsCache = data.reservations || [];
        } catch {
            reservationsCache = [];
        }

        renderReservations();
        refreshDashboard();
    }

    function renderReservations() {
        const list = document.getElementById("resList");
        const summaryText = document.getElementById("resSummaryText");
        const summaryList = document.getElementById("resSummaryList");

        list.innerHTML = "";
        summaryList.innerHTML = "";

        if (reservationsCache.length === 0) {
            list.innerHTML = "<p>No reservations yet.</p>";
            summaryText.textContent = "No reservations recorded in the system.";
            return;
        }

        reservationsCache.forEach(r => {
            list.innerHTML += `
                <div class="res-list-item">
                    <b>${r.name}</b><br>
                    ${r.date} at ${r.time}<br>
                    Party of ${r.size}
                </div>
            `;
        });

        summaryText.textContent =
            `Total reservations: ${reservationsCache.length}. This panel simply reads from /api/reservations.`;

        // Simple stats: count by date
        const byDate = {};
        reservationsCache.forEach(r => {
            if (!r.date) return;
            byDate[r.date] = (byDate[r.date] || 0) + 1;
        });

        Object.entries(byDate).forEach(([date, count]) => {
            summaryList.innerHTML += `<li>${date}: ${count} reservation(s)</li>`;
        });
    }

    async function loadMenuAdmin() {
        try {
            const res = await fetch(`${API_BASE}/api/menu`);
            if (!res.ok) throw new Error();
            const data = await res.json();
            menuCache = data.menu || [];
        } catch {
            menuCache = [];
        }

        const grid = document.getElementById("menuGridAdmin");
        grid.innerHTML = "";

        if (menuCache.length === 0) {
            grid.innerHTML = "<p>No menu items returned from backend.</p>";
            return;
        }

        menuCache.forEach(item => {
            grid.innerHTML += `
                <div class="menu-card">
                    <img src="${item.img}" alt="${item.name}">
                    <div class="menu-card-body">
                        <strong>${item.name}</strong>
                        <div class="menu-card-footer">
                            <span>AED ${Number(item.price || 0).toFixed(2)}</span>
                            <span style="font-size:11px; color:${'#6b7280'};">ID: ${item.id}</span>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    async function loadAnalytics() {
        try {
            const res = await fetch(`${API_BASE}/api/analytics`);
            if (!res.ok) throw new Error();
            const data = await res.json();

            document.getElementById("anTotalOrders").textContent = data.total_orders || 0;
            document.getElementById("anTotalRevenue").textContent =
                Number(data.total_revenue || 0).toFixed(2);

            const list = document.getElementById("analyticsTopItems");
            list.innerHTML = "";
            if (!data.top_items || data.top_items.length === 0) {
                list.innerHTML = "<li>No top items yet (no orders).</li>";
            } else {
                data.top_items.forEach(t => {
                    list.innerHTML += `<li>${t.name} ‚Äî ${t.count} orders</li>`;
                });
            }

        } catch {
            document.getElementById("anTotalOrders").textContent = "0";
            document.getElementById("anTotalRevenue").textContent = "0";
            document.getElementById("analyticsTopItems").innerHTML =
                "<li>Failed to load analytics.</li>";
        }
    }

    // -------- DASHBOARD REFRESH ----------
    async function refreshDashboard() {
        // Use analytics + reservations + orders to fill top cards
        try {
            const [anRes, resRes] = await Promise.all([
                fetch(`${API_BASE}/api/analytics`),
                fetch(`${API_BASE}/api/reservations`)
            ]);

            let anData = { total_orders: 0, total_revenue: 0, top_items: [] };
            if (anRes.ok) anData = await anRes.json();

            let resData = { reservations: [] };
            if (resRes.ok) resData = await resRes.json();

            document.getElementById("dashTotalOrders").textContent =
                anData.total_orders || 0;
            document.getElementById("dashTotalRevenue").textContent =
                Number(anData.total_revenue || 0).toFixed(2);
            document.getElementById("dashTotalReservations").textContent =
                (resData.reservations || []).length;

            const top = (anData.top_items || [])[0];
            document.getElementById("dashTopItem").textContent = top
                ? top.name
                : "‚Äì";

        } catch {
            // ignore, leave defaults
        }
    }

    // -------- INIT ----------
    function initAdmin() {
        checkBackend();
        loadOrders();
        loadReservations();
        loadMenuAdmin();
        loadAnalytics();
    }
</script>

</body>
</html>
